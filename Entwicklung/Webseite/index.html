<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    />
  </head>
  <body>
    <button onclick="loadXMLDoc()" style="margin: 20px;">Fetch Data</button
    ><br />
    <button id="displayButton" onclick="onDisplayButton()">Display Data</button
    ><br />
    <div id="xmlOutput">This is where the html output will appear</div>
    <br />
    <div class="container">
      <canvas id="myChart" width="100%" height="50%"></canvas>
    </div>
    <script>
        var stampLabels = [];
        var stampDataDone = [];
        let dataMerge = [];

        function loadXMLDoc() {
            var xhttp = new XMLHttpRequest();
            var values = [];
            var timeStamps = [];
            var labels = [];
            var data = [];
            var stampData = [];

            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    values = this.responseText.split(",");
                    var buffer = [];
                    labels = values.slice(0, 65);
                    data = values.slice(65);
                    stampLabels.push(labels.slice(0, 27));
                    stampLabels.push(labels.slice(27, 54));
                    stampLabels.push(labels.slice(55, 65));
                    for (var i = 0; i < 27; i++) {
                        stampData.push(data.slice(i * 11, (i + 1) * 11));
                    }
                    stampDataDone = stampData.map(item => {
                        return item.slice(1, item.length).map(item1 => {
                            item1 = checkFor(item1, 0, [' ', ';', '.']);
                            if (item1 === "") {
                                return item1.replace('', '-');
                            }
                            return item1;
                        });
                    });
                    var buff = 0
                    stampDataDone.forEach(item =>{
                       buff = parseInt(item[2]);
                       dataMerge.push(buff);
                   });
                    
                }
            };
            xhttp.open("GET", "Marco_Deuritz_2020-04-16_16-30-25.CSV", true);
            xhttp.send();

            document.getElementById('displayButton').style.backgroundColor = "green";
            drawChart();
        }

        function onDisplayButton() {
            displayTable(stampLabels[2], stampDataDone);
        }

        function displayTable(label = "0", data = "0") {
            var outputBox = document.getElementById('xmlOutput');
            var output = "";
            output += "<table>";
            output += "<tr>";

            label.forEach(item => {

                output += "<th>" + item + "</th>";
            });
            output += "</tr>";
            output += "<br>";
            data.forEach(item => {
                output += "<tr>";
                item.forEach(item1 => {
                    output += "<td>" + item1 + "</t>";
                });
                output += "</tr>";
            });
            output += "</table>";
            outputBox.innerHTML = output;
        }

        function checkFor(item, i, syntax) {
            if (i < 10) {
                for (let count of syntax) {
                    if (item.endsWith(count)) {
                        return checkFor(item.slice(0, item.length - 1), i + 1, syntax);
                    }
                    if (item.startsWith(count)) {
                        return checkFor(item.slice(1, item.length), i + 1, syntax);
                    }
                }
            } else {
                console.log(
                    item + ":  There has bee an error, too many special characters!"
                );
            }
            return item;
        };
function drawChart(){
    console.log(dataMerge);
      let ctx = document.getElementById("myChart").getContext('2d');
      let chartSettings = {
        type: "line",
        data: {
          labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
          datasets: [
            {
              label: "# of Votes",
              data: dataMerge.slice(0,6),
              backgroundColor: [
                "rgba(255, 99, 132, 0.2)",
                "rgba(54, 162, 235, 0.2)",
                "rgba(255, 206, 86, 0.2)",
                "rgba(75, 192, 192, 0.2)",
                "rgba(153, 102, 255, 0.2)",
                "rgba(255, 159, 64, 0.2)",
              ],
              borderColor: [
                "rgba(255, 99, 132, 1)",
                "rgba(54, 162, 235, 1)",
                "rgba(255, 206, 86, 1)",
                "rgba(75, 192, 192, 1)",
                "rgba(153, 102, 255, 1)",
                "rgba(255, 159, 64, 1)",
              ],
              borderWidth: 2,
              fill: "none",
              borderColor:"rgba(120, 190, 240, 0.8)",
              borderDash: [10, 10],
              cubicInterpolationMode: "default",
              lineTension: 0.4,
            },
          ],
        },
        options: {
        legend: {
            position: "left",
        },
          scales: {
            yAxes: [
              {
                ticks: {
                  beginAtZero: true,
                },
              },
            ],
            xAxes: [
              {
                ticks: {
                  beginAtZero: true,
                },
              },
            ],
          },
        },
      }
      let myChart = new Chart(ctx, chartSettings);
    }
    </script>
  </body>
</html>
